{% extends "base.html" %}
{% block title %}TruthGuard â€¢ Feedback{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/feedback.css') }}?v=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
{% endblock %}

{% block content %}
<div class="auth-bg min-h-screen">
  <div class="auth-content">
    <!-- Hero Section -->
    <section class="relative isolate mx-auto max-w-7xl px-4 pt-12 md:px-6 md:pt-16">
      <div class="mx-auto max-w-md">
        <!-- Hero -->
        <div class="auth-hero fade-in">
          <span class="auth-badge">
            <span class="h-2 w-2 rounded-full bg-indigo-500"></span>
            We value your input
          </span>
          
          <h1 class="auth-title">
            Share Your Feedback
          </h1>
          
          <p class="auth-subtitle">
            Help us improve TruthGuard with your thoughts and suggestions
          </p>
        </div>

        <!-- Feedback Form Card -->
        <div class="auth-card p-8 fade-in">
          <div class="text-center mb-8">
            <div class="method-icon bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 mx-auto mb-4">
              <i class="bi bi-chat-heart"></i>
            </div>
            <h2 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-2">
              Your Opinion Matters
            </h2>
            <p class="text-neutral-600 dark:text-neutral-400">
              Share your experience and help us make TruthGuard even better
            </p>
          </div>

          <!-- Feedback Form -->
          <form method="POST" class="space-y-6" id="feedbackForm">
            <!-- Name Field (Optional) -->
            <div class="form-group">
              <label for="name" class="form-label">
                <i class="bi bi-person form-icon"></i>
                Name (Optional)
              </label>
              <div class="relative">
                <input 
                  type="text" 
                  id="name" 
                  name="name" 
                  value="{{ name or '' }}"
                  class="auth-input ring-1 ring-inset ring-neutral-400/40 dark:ring-white/15 focus:ring-2 focus:ring-indigo-600 dark:focus:ring-2 dark:focus:ring-indigo-600"
                  placeholder="Enter your name (optional)"
                  autocomplete="name"
                />
                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                  <i class="bi bi-person-badge text-neutral-400"></i>
                </div>
              </div>
            </div>

            <!-- Rating Field -->
            <div class="form-group">
              <label for="rating" class="form-label">
                <i class="bi bi-star form-icon"></i>
                Rating
              </label>
              <div class="requirements-list">
                <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-3">
                  How would you rate your experience with TruthGuard?
                </p>
                <div class="star-rating" role="radiogroup" aria-label="Rating">
                  {% for i in range(5, 0, -1) %}
                  <input 
                    type="radio" 
                    id="star{{ i }}" 
                    name="rating" 
                    value="{{ i }}" 
                    class="star-input"
                    {% if rating and rating == i %}checked{% endif %}
                    required
                  />
                  <label for="star{{ i }}" class="star-label" title="{{ i }} star{{ 's' if i != 1 else '' }}">
                    <i class="bi bi-star-fill"></i>
                  </label>
                  {% endfor %}
                </div>
                <div class="rating-text">
                  <span class="rating-description text-sm text-neutral-500 dark:text-neutral-400"></span>
                </div>
              </div>
            </div>

            <!-- Comments Field -->
            <div class="form-group">
              <label for="comments" class="form-label">
                <i class="bi bi-chat-text form-icon"></i>
                Comments
              </label>
              <div class="relative">
                <textarea 
                  id="comments" 
                  name="comments"
                  rows="5"
                  class="auth-input ring-1 ring-inset ring-neutral-400/40 dark:ring-white/15 focus:ring-2 focus:ring-indigo-600 dark:focus:ring-2 dark:focus:ring-indigo-600"
                  placeholder="Share your thoughts, suggestions, or report any issues you've encountered..."
                  required
                  style="resize: vertical; min-height: 120px;"
                >{{ comments or '' }}</textarea>
                <div class="absolute top-3 right-3">
                  <i class="bi bi-chat-square-text text-neutral-400"></i>
                </div>
              </div>
              <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-2">
                Please be specific about what you liked or what could be improved.
              </p>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <div class="flex space-x-3">
                <button 
                  type="submit" 
                  class="auth-btn-primary flex-1"
                  id="submitBtn"
                >
                  <span class="btn-content">
                    <i class="bi bi-send mr-2"></i>
                    Submit
                  </span>
                  <span class="btn-loading hidden">
                    <span class="loading-spinner"></span>
                    Submitting...
                  </span>
                </button>
                <button 
                  type="button" 
                  class="auth-btn-secondary flex-1"
                  id="resetBtn"
                >
                  <i class="bi bi-arrow-clockwise mr-2"></i>
                  Reset
                </button>
              </div>
            </div>
          </form>

          <!-- Back to Home Link -->
          <div class="text-center mt-6">
            <p class="text-neutral-600 dark:text-neutral-400">
              Want to continue fact-checking? 
              <a href="{{ url_for('main.index') }}" class="auth-link">
                Back to Home
              </a>
            </p>
          </div>
        </div>

        <!-- Features Section -->
        <div class="features-grid fade-in">
          <div class="feature-item">
            <div class="feature-icon bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400">
              <i class="bi bi-lightbulb"></i>
            </div>
            <h3 class="text-sm font-semibold text-neutral-800 dark:text-neutral-200 mb-1">Improve Features</h3>
            <p class="text-xs text-neutral-600 dark:text-neutral-400">Help us enhance functionality</p>
          </div>
          
          <div class="feature-item">
            <div class="feature-icon bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400">
              <i class="bi bi-bug"></i>
            </div>
            <h3 class="text-sm font-semibold text-neutral-800 dark:text-neutral-200 mb-1">Report Issues</h3>
            <p class="text-xs text-neutral-600 dark:text-neutral-400">Let us know about problems</p>
          </div>
          
          <div class="feature-item">
            <div class="feature-icon bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400">
              <i class="bi bi-heart"></i>
            </div>
            <h3 class="text-sm font-semibold text-neutral-800 dark:text-neutral-200 mb-1">Share Love</h3>
            <p class="text-xs text-neutral-600 dark:text-neutral-400">Tell us what you enjoy</p>
          </div>
        </div>

        <!-- User Guidance Section -->
        <div class="auth-card p-6 mt-8 fade-in">
          <h3 class="text-lg font-semibold text-neutral-800 dark:text-neutral-200 mb-4">
            <i class="bi bi-info-circle text-indigo-600 dark:text-indigo-400 mr-2"></i>
            Feedback Guidelines
          </h3>
          <div class="space-y-3 text-sm text-neutral-600 dark:text-neutral-400">
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-green-500 mt-0.5"></i>
              <span>Be specific about features you'd like to see improved</span>
            </div>
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-green-500 mt-0.5"></i>
              <span>Report any bugs or issues you've encountered</span>
            </div>
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-green-500 mt-0.5"></i>
              <span>Share what you love about TruthGuard</span>
            </div>
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-green-500 mt-0.5"></i>
              <span>Suggest new features that would be helpful</span>
            </div>
          </div>
        </div>

        <!-- Navigation Link -->
        <div class="text-center mt-8 fade-in">
          <a href="{{ url_for('main.index') }}" class="action-btn action-btn-primary text-lg px-8 py-4">
            <i class="bi bi-arrow-left mr-3"></i>
            Back to Home
          </a>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Feedback Confirmation Modal -->
<div id="feedbackConfirmModal" class="fixed inset-0 modal-backdrop z-50 hidden">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="modal-card w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col">
      <!-- Fixed Header -->
      <div class="flex justify-between items-center p-6 border-b border-neutral-200 dark:border-neutral-700">
        <h2 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200">
          <i class="bi bi-chat-heart text-indigo-600 dark:text-indigo-400 mr-2"></i>
          Confirm Feedback Submission
        </h2>
        <button id="closeFeedbackConfirmModal" class="text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 transition-colors">
          <i class="bi bi-x-lg text-xl"></i>
        </button>
      </div>
      
      <!-- Scrollable Content -->
      <div id="feedbackConfirmContent" class="flex-1 overflow-y-auto p-6">
        <!-- Title and Icon -->
        <div class="text-center mb-6">
          <div class="results-icon bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-400 mx-auto mb-6" style="width: 4rem; height: 4rem; font-size: 2rem;">
            <i class="bi bi-question-circle"></i>
          </div>
          <h3 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-6">
            Ready to Submit?
          </h3>
          
          <!-- Only this info box should have card styling -->
          <div class="bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-xl p-6 backdrop-filter backdrop-blur-sm shadow-sm">
            <div class="flex items-center justify-center mb-4">
              <i class="bi bi-info-circle text-indigo-600 dark:text-indigo-400 mr-2"></i>
              <span class="text-sm font-medium text-indigo-700 dark:text-indigo-300">Review Your Feedback</span>
            </div>
            <p class="text-indigo-700 dark:text-indigo-300 text-sm leading-relaxed">
              Please review your feedback before submitting. Once submitted, your feedback will help us improve TruthGuard.
            </p>
          </div>
        </div>
        
        <!-- Plain feedback review sections without card styling -->
        <div class="space-y-6">
          <div>
            <div class="text-sm font-weight-600 text-neutral-700 dark:text-neutral-300 mb-3 uppercase tracking-wide">Rating</div>
            <div id="confirmRating" class="modal-rating-display">
              <!-- Stars will be populated by JavaScript -->
            </div>
          </div>
          
          <div class="border-t border-neutral-300 dark:border-neutral-600 pt-6">
            <div class="text-sm font-weight-600 text-neutral-700 dark:text-neutral-300 mb-3 uppercase tracking-wide">Name</div>
            <div id="confirmName" class="text-neutral-800 dark:text-neutral-200 font-medium">Anonymous</div>
          </div>
          
          <div class="border-t border-neutral-300 dark:border-neutral-600 pt-6">
            <div class="text-sm font-weight-600 text-neutral-700 dark:text-neutral-300 mb-3 uppercase tracking-wide">Comments</div>
            <div id="confirmComments" class="text-neutral-800 dark:text-neutral-200 leading-relaxed"></div>
          </div>
        </div>
      </div>
      
      <!-- Fixed Footer for Actions -->
      <div class="border-t border-neutral-200 dark:border-neutral-700 p-4">
        <div class="flex justify-center space-x-3">
          <button id="confirmFeedbackSubmit" class="action-btn action-btn-primary w-40">
            <i class="bi bi-send mr-2"></i>
            Submit
          </button>
          <button id="cancelFeedbackSubmit" class="action-btn action-btn-secondary w-40">
            <i class="bi bi-x-circle mr-2"></i>
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Feedback Result Modal -->
<div id="feedbackResultModal" class="fixed inset-0 modal-backdrop z-50 hidden">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="modal-card w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col">
      <!-- Fixed Header -->
      <div class="flex justify-between items-center p-6 border-b border-neutral-200 dark:border-neutral-700">
        <h2 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200">
          <i class="bi bi-chat-heart text-indigo-600 dark:text-indigo-400 mr-2"></i>
          <span id="resultModalTitle">Feedback Submitted</span>
        </h2>
        <button id="closeFeedbackResultModal" class="text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 transition-colors">
          <i class="bi bi-x-lg text-xl"></i>
        </button>
      </div>
      
      <!-- Scrollable Content -->
      <div id="feedbackResultContent" class="flex-1 overflow-y-auto p-6 text-center">
        <!-- Loading State -->
        <div id="feedbackLoading" class="mb-4">
          <div class="text-center">
            <div class="mx-auto mb-6" style="width: 4rem; height: 4rem; display: flex; align-items: center; justify-content: center;">
              <div class="loading-spinner"></div>
            </div>
            <h3 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-3">
              Submitting Feedback
            </h3>
            <p class="text-neutral-600 dark:text-neutral-400 mb-6 max-w-md mx-auto">
              Please wait while we save your feedback and process your input...
            </p>
            <div class="flex items-center justify-center space-x-2 mb-4">
              <div class="w-2 h-2 bg-indigo-600 rounded-full animate-bounce"></div>
              <div class="w-2 h-2 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
              <div class="w-2 h-2 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
            <p class="text-sm text-neutral-600 dark:text-neutral-400 text-center font-medium">
              This will only take a moment...
            </p>
          </div>
        </div>
        
        <!-- Error State -->
        <div id="feedbackError" class="hidden">
          <div class="text-center">
            <div class="results-icon bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-400 mx-auto mb-6" style="width: 4rem; height: 4rem; font-size: 2rem;">
              <i class="bi bi-exclamation-triangle"></i>
            </div>
            <h3 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-6">
              Submission Failed
            </h3>
            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 backdrop-filter backdrop-blur-sm shadow-sm">
              <div class="flex items-center justify-center mb-4">
                <i class="bi bi-info-circle text-red-600 dark:text-red-400 mr-2"></i>
                <span class="text-sm font-medium text-red-700 dark:text-red-300">Error Details</span>
              </div>
              <p id="feedbackErrorMessage" class="text-red-700 dark:text-red-300 text-sm leading-relaxed">
                An error occurred while submitting your feedback. Please try again.
              </p>
            </div>
          </div>
        </div>
        
        <!-- Success State -->
        <div id="feedbackSuccess" class="hidden">
          <div class="text-center">
            <div class="results-icon bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 mx-auto mb-6" style="width: 4rem; height: 4rem; font-size: 2rem;">
              <i class="bi bi-check-circle"></i>
            </div>
            <h3 class="text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-6">
              Thank You!
            </h3>
            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6 backdrop-filter backdrop-blur-sm shadow-sm">
              <div class="flex items-center justify-center mb-4">
                <i class="bi bi-heart text-green-600 dark:text-green-400 mr-2"></i>
                <span class="text-sm font-medium text-green-700 dark:text-green-300">Feedback Received</span>
              </div>
              <p class="text-green-700 dark:text-green-300 text-sm leading-relaxed">
                Your feedback has been successfully submitted. We appreciate your input and will use it to improve TruthGuard!
              </p>
              <div class="mt-4 p-3 bg-green-100 dark:bg-green-900/30 rounded-lg">
                <p class="text-xs text-green-600 dark:text-green-400">
                  <i class="bi bi-lightbulb mr-1"></i>
                  Your feedback helps us build better fact-checking tools for everyone.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Fixed Footer for Actions -->
      <div id="feedbackResultFooter" class="border-t border-neutral-200 dark:border-neutral-700 p-4">
        <div class="flex justify-center gap-3">
          <button id="retryFeedbackSubmit" class="hidden action-btn action-btn-secondary">
            <i class="bi bi-arrow-clockwise mr-2"></i>
            Try Again
          </button>
          <button id="closeFeedbackResultBtn" class="hidden action-btn action-btn-primary">
            <i class="bi bi-check mr-2"></i>
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/feedback.js') }}"></script>
{% endblock %}
